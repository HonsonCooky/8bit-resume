<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>C:\HarrisonCook&gt;</title>
		<link rel="icon" href="./assets/favicon.png" />
		<style>
			:root {
				--base: black;
				--text: white;
				--error: red;
				--cmd: green;
				--param: blue;
				--mute: gray;

				@media (prefers-color-scheme: light) {
					--base: white;
					--text: black;
				}
			}

			* {
				box-sizing: border-box;
				font-family: "Courier New", Courier, monospace;
				color: var(--text);
			}

			@keyframes blink {
				50% {
					opacity: 0%;
				}
			}

			html,
			body {
				background-color: var(--base);
				border: none;
				font-size: 12pt;
				margin: 0;
			}

			#input,
			#output {
				padding: 0.2em 1ch;
			}

			#input {
				display: flex;
				flex-direction: row;
				column-gap: 1ch;
				align-items: center;
				bottom: 0;
				height: 1.4em;
				position: sticky;
			}

			#prompt {
				display: flex;
			}

			#buffer-container {
				display: inline-block;
				position: relative;
				height: 1.2em;
			}

			#buffer {
				display: flex;
				flex-direction: row;
				column-gap: 1ch;

				.cmd {
					color: var(--cmd);
				}

				.param {
					color: var(--param);
				}

				.hint {
					color: var(--mute);
				}

				.unknown {
					color: var(--error);
				}
			}

			#caret {
				position: absolute;
				bottom: 0;
				left: 0;
				height: calc(1.2em * 0.25);
				width: 1ch;
				background-color: var(--cmd);
				animation: blink 0.75s step-start infinite;
			}
		</style>

		<script type="text/javascript" id="file-data" defer>
			const fileStructure = {
				profile: ["overview.txt", "traits.txt"],
				quests: {
					main_quests: ["xero.txt", "z-energy.txt", "raygun.txt", "vic-uni.txt"],
					side_quests: ["vim.txt", "aoc.txt", "mmcam.txt"],
				},
				inventory: {
					education: ["be-eng.txt", "ncea.txt"],
					toolbox: ["languages.txt", "frameworks.txt", "devops.txt"],
				},
			};

			const commands = {
				help: ["Display a list available commands.", "Usage: [CMD] :help"],
				cat: {
					help: ["Concatenate a single FILE to standard output.", "Usage: cat $FILE"],
					exec: function (filePath) {
						console.log("cat", filePath);
					},
				},
				cd: {
					help: ["Change the current directory to DIR.", "Usage: cd $DIR"],
					exec: function (params) {
						console.log("cd", params);
					},
				},
				ls: {
					help: [
						"List information about the files in the DIR. DIR is the cwd by default.",
						"Usage: ls [DIR]",
					],
					exec: function (params) {
						return typeof value === "string";
					},
				},
				open: {
					help: [],
				},
				whoami: {
					help: ["Print infomation about the current effective user ID (HonsonCooky).", "Usage: whoami"],
					exec: function (_) {
						console.log("whoami", params);
					},
				},
			};
		</script>
		<script type="text/javascript" id="keyboard-events">
			document.addEventListener("keydown", onKeyDown);

			/** @param {KeyboardEvent} ev */
			function onKeyDown(ev) {
				switch (ev.key) {
					case "Backspace":
						let bsDiff = ev.ctrlKey ? getCtrlBackspaceDiff() : 1;
						inBufCarPos = Math.max(0, inBufCarPos - bsDiff);
						inBufArr.splice(inBufCarPos, bsDiff);
						break;
					case "Delete":
						let delDiff = ev.ctrlKey ? getCtrlDeleteDiff() : 1;
						inBufArr.splice(inBufCarPos, delDiff);
						break;
					case "ArrowLeft":
						inBufCarPos = Math.max(0, inBufCarPos - 1);
						break;
					case "ArrowRight":
						inBufCarPos = Math.min(inBufArr.length, inBufCarPos + 1);
						break;
					case "Enter":
						evaluateCmd();
						// Clear Buffer
						inBufArr = [];
						inBufCarPos = 0;
						break;
					default:
						if (inBufArr.length >= 64) {
							alert("Too Much Input (64 char limit)");
							break;
						}
						if (ev.key.length > 1 || ev.ctrlKey) {
							console.log(`Unmapped Input ${ev.key}`);
							break;
						}
						inBufArr.splice(inBufCarPos, 0, ev.key.toLowerCase());
						inBufCarPos += ev.key.length;
				}

				// Tokenize, Evaluate, and Render characters.
				ev.preventDefault();
			}

			/**
			 * Returns the difference from the current cursor position to previous
			 * white char.
			 */
			function getCtrlBackspaceDiff() {
				let i = inBufCarPos - 1;
				while (i > 0) {
					if (inBufArr[i] === " ") break;
					i--;
				}
				return inBufCarPos - i;
			}

			/**
			 * Returns the difference from the current possiton to the next white
			 * char.
			 */
			function getCtrlDeleteDiff() {
				let i = inBufCarPos + 1;
				while (i < inBufArr.length) {
					if (inBufArr[i] === " ") break;
					i++;
				}
				return i - inBufCarPos;
			}
		</script>
	</head>

	<body>
		<div id="output"></div>
		<div id="input">
			<span id="prompt">
				<span id="root">C:\HarrisonCook</span>
				<span id="cwd-path"></span>
				<span id="seperator">&gt;</span>
			</span>
			<div id="buffer-container">
				<span id="buffer"></span>
				<span id="caret"></span>
			</div>
		</div>
	</body>
</html>
